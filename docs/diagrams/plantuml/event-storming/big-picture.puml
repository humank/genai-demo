@startuml Big Picture Event Storming
!theme plain
title GenAI Demo - Big Picture Event Storming (標準化配色)

' Event Storming 標準配色定義 - 符合官方規範
skinparam rectangle {
    ' 事件 - 橙色系 (#FFA500)
    BackgroundColor<<Event>> #FFA500
    BorderColor<<Event>> #FF8C00
    FontColor<<Event>> #000000
    
    ' 熱點/問題 - 紅色系 (#FF0000)
    BackgroundColor<<Hotspot>> #FF0000
    BorderColor<<Hotspot>> #DC143C
    FontColor<<Hotspot>> #FFFFFF
    
    ' 參與者 - 黃色系 (#FFD700)
    BackgroundColor<<Actor>> #FFD700
    BorderColor<<Actor>> #DAA520
    FontColor<<Actor>> #000000
    
    ' 外部系統 - 粉色系 (#FF69B4)
    BackgroundColor<<ExternalSystem>> #FF69B4
    BorderColor<<ExternalSystem>> #FF1493
    FontColor<<ExternalSystem>> #000000
    
    ' 機會點 - 綠色系 (#32CD32)
    BackgroundColor<<Opportunity>> #32CD32
    BorderColor<<Opportunity>> #228B22
    FontColor<<Opportunity>> #000000
    
    ' 命令 - 藍色系 (#1E90FF)
    BackgroundColor<<Command>> #1E90FF
    BorderColor<<Command>> #0000FF
    FontColor<<Command>> #FFFFFF
    
    ' 聚合 - 黃色系 (#FFFF00)
    BackgroundColor<<Aggregate>> #FFFF00
    BorderColor<<Aggregate>> #FFD700
    FontColor<<Aggregate>> #000000
    
    ' 讀模型 - 綠色系 (#32CD32)
    BackgroundColor<<ReadModel>> #32CD32
    BorderColor<<ReadModel>> #228B22
    FontColor<<ReadModel>> #000000
    
    ' 策略 - 紫色系 (#800080)
    BackgroundColor<<Policy>> #800080
    BorderColor<<Policy>> #4B0082
    FontColor<<Policy>> #FFFFFF
    
    ' UI 模型 - 淺黃色系 (#F0E68C)
    BackgroundColor<<UI>> #F0E68C
    BorderColor<<UI>> #DAA520
    FontColor<<UI>> #000000
}

' 參與者 (Actor - 黃色)
rectangle "消費者" as Consumer <<Actor>>
rectangle "管理員" as Admin <<Actor>>
rectangle "客服" as Support <<Actor>>

' 外部系統 (External System - 粉色)
rectangle "支付閘道" as PaymentGateway <<ExternalSystem>>
rectangle "物流系統" as LogisticsSystem <<ExternalSystem>>
rectangle "郵件服務" as EmailService <<ExternalSystem>>
rectangle "簡訊服務" as SMSService <<ExternalSystem>>
rectangle "分析系統" as AnalyticsSystem <<ExternalSystem>>

' 產品瀏覽和選擇流程
rectangle "瀏覽產品目錄" as BrowseCatalog <<Command>>
rectangle "產品已瀏覽" as ProductViewed <<Event>>
rectangle "產品" as Product <<Aggregate>>
rectangle "產品目錄視圖" as ProductCatalogView <<ReadModel>>

rectangle "搜尋產品" as SearchProduct <<Command>>
rectangle "搜尋已執行" as SearchExecuted <<Event>>
rectangle "搜尋結果視圖" as SearchResultView <<ReadModel>>

rectangle "查看產品詳情" as ViewProductDetails <<Command>>
rectangle "產品詳情已查看" as ProductDetailsViewed <<Event>>
rectangle "產品詳情視圖" as ProductDetailsView <<ReadModel>>

' 購物車管理流程
rectangle "添加到購物車" as AddToCart <<Command>>
rectangle "商品已添加到購物車" as ItemAddedToCart <<Event>>
rectangle "購物車" as ShoppingCart <<Aggregate>>
rectangle "購物車視圖" as CartView <<ReadModel>>

rectangle "更新購物車數量" as UpdateCartQuantity <<Command>>
rectangle "購物車數量已更新" as CartQuantityUpdated <<Event>>

rectangle "移除購物車商品" as RemoveFromCart <<Command>>
rectangle "商品已從購物車移除" as ItemRemovedFromCart <<Event>>

' 庫存管理流程
rectangle "檢查庫存" as CheckInventory <<Command>>
rectangle "庫存已檢查" as InventoryChecked <<Event>>
rectangle "庫存不足" as InsufficientInventory <<Hotspot>>
rectangle "庫存預留政策" as InventoryReservationPolicy <<Policy>>
rectangle "庫存已預留" as InventoryReserved <<Event>>
rectangle "庫存視圖" as InventoryView <<ReadModel>>

' 訂單處理流程
rectangle "創建訂單" as CreateOrder <<Command>>
rectangle "訂單已創建" as OrderCreated <<Event>>
rectangle "訂單" as Order <<Aggregate>>
rectangle "訂單視圖" as OrderView <<ReadModel>>

rectangle "確認訂單" as ConfirmOrder <<Command>>
rectangle "訂單已確認" as OrderConfirmed <<Event>>

rectangle "取消訂單" as CancelOrder <<Command>>
rectangle "訂單已取消" as OrderCancelled <<Event>>

' 客戶管理流程
rectangle "註冊客戶" as RegisterCustomer <<Command>>
rectangle "客戶已註冊" as CustomerRegistered <<Event>>
rectangle "客戶" as Customer <<Aggregate>>
rectangle "客戶資料視圖" as CustomerProfileView <<ReadModel>>

rectangle "更新客戶資料" as UpdateCustomerProfile <<Command>>
rectangle "客戶資料已更新" as CustomerProfileUpdated <<Event>>

rectangle "客戶消費已更新" as CustomerSpendingUpdated <<Event>>
rectangle "忠誠度政策" as LoyaltyPolicy <<Policy>>
rectangle "忠誠度積分已獲得" as LoyaltyPointsEarned <<Event>>
rectangle "忠誠度視圖" as LoyaltyView <<ReadModel>>

' 支付處理流程
rectangle "處理支付" as ProcessPayment <<Command>>
rectangle "支付已處理" as PaymentProcessed <<Event>>
rectangle "支付" as Payment <<Aggregate>>
rectangle "支付視圖" as PaymentView <<ReadModel>>

rectangle "支付失敗" as PaymentFailed <<Event>>
rectangle "支付重試政策" as PaymentRetryPolicy <<Policy>>
rectangle "支付安全問題" as PaymentSecurityIssue <<Hotspot>>

rectangle "退款處理" as ProcessRefund <<Command>>
rectangle "退款已處理" as RefundProcessed <<Event>>

' 物流和配送流程
rectangle "安排配送" as ArrangeShipping <<Command>>
rectangle "配送已安排" as ShippingArranged <<Event>>
rectangle "配送狀態已更新" as ShippingStatusUpdated <<Event>>
rectangle "配送視圖" as ShippingView <<ReadModel>>

rectangle "訂單已出貨" as OrderShipped <<Event>>
rectangle "訂單已送達" as OrderDelivered <<Event>>

' 通知流程
rectangle "通知政策" as NotificationPolicy <<Policy>>
rectangle "訂單確認通知已發送" as OrderConfirmationSent <<Event>>
rectangle "配送通知已發送" as ShippingNotificationSent <<Event>>
rectangle "送達通知已發送" as DeliveryNotificationSent <<Event>>

' 促銷和折扣流程
rectangle "應用促銷" as ApplyPromotion <<Command>>
rectangle "促銷已應用" as PromotionApplied <<Event>>
rectangle "促銷" as Promotion <<Aggregate>>
rectangle "折扣政策" as DiscountPolicy <<Policy>>
rectangle "促銷視圖" as PromotionView <<ReadModel>>

' 客服和支援流程
rectangle "創建客服工單" as CreateSupportTicket <<Command>>
rectangle "客服工單已創建" as SupportTicketCreated <<Event>>
rectangle "客服工單" as SupportTicket <<Aggregate>>
rectangle "客服視圖" as SupportView <<ReadModel>>

' 分析和報告流程
rectangle "生成銷售報告" as GenerateSalesReport <<Command>>
rectangle "銷售報告已生成" as SalesReportGenerated <<Event>>
rectangle "銷售報告視圖" as SalesReportView <<ReadModel>>

' 機會點
rectangle "個人化推薦" as PersonalizationOpportunity <<Opportunity>>
rectangle "預測性庫存" as PredictiveInventoryOpportunity <<Opportunity>>
rectangle "自動化客服" as AutomatedSupportOpportunity <<Opportunity>>

' UI 模型
rectangle "產品目錄頁面" as ProductCatalogUI <<UI>>
rectangle "購物車頁面" as ShoppingCartUI <<UI>>
rectangle "結帳頁面" as CheckoutUI <<UI>>
rectangle "訂單追蹤頁面" as OrderTrackingUI <<UI>>
rectangle "客戶資料頁面" as CustomerProfileUI <<UI>>

' 流程連接 - 產品瀏覽
Consumer --> BrowseCatalog
BrowseCatalog --> ProductViewed
ProductViewed --> Product
ProductViewed --> ProductCatalogView
ProductCatalogView --> ProductCatalogUI

Consumer --> SearchProduct
SearchProduct --> SearchExecuted
SearchExecuted --> SearchResultView

Consumer --> ViewProductDetails
ViewProductDetails --> ProductDetailsViewed
ProductDetailsViewed --> ProductDetailsView
ProductDetailsView --> ProductCatalogUI

' 流程連接 - 購物車
Consumer --> AddToCart
AddToCart --> ItemAddedToCart
ItemAddedToCart --> ShoppingCart
ItemAddedToCart --> CartView
CartView --> ShoppingCartUI

Consumer --> UpdateCartQuantity
UpdateCartQuantity --> CartQuantityUpdated
CartQuantityUpdated --> ShoppingCart

Consumer --> RemoveFromCart
RemoveFromCart --> ItemRemovedFromCart
ItemRemovedFromCart --> ShoppingCart

' 流程連接 - 庫存
AddToCart --> CheckInventory
CheckInventory --> InventoryChecked
InventoryChecked --> Product
InventoryChecked --> InventoryView
InventoryReservationPolicy --> InventoryReserved
InventoryReserved --> Product

' 流程連接 - 訂單
Consumer --> CreateOrder
CreateOrder --> OrderCreated
OrderCreated --> Order
OrderCreated --> OrderView
OrderView --> CheckoutUI

Admin --> ConfirmOrder
ConfirmOrder --> OrderConfirmed
OrderConfirmed --> Order

Consumer --> CancelOrder
CancelOrder --> OrderCancelled
OrderCancelled --> Order

' 流程連接 - 客戶
Consumer --> RegisterCustomer
RegisterCustomer --> CustomerRegistered
CustomerRegistered --> Customer
CustomerRegistered --> CustomerProfileView
CustomerProfileView --> CustomerProfileUI

Consumer --> UpdateCustomerProfile
UpdateCustomerProfile --> CustomerProfileUpdated
CustomerProfileUpdated --> Customer

OrderCreated --> CustomerSpendingUpdated
CustomerSpendingUpdated --> Customer
LoyaltyPolicy --> LoyaltyPointsEarned
LoyaltyPointsEarned --> Customer
LoyaltyPointsEarned --> LoyaltyView

' 流程連接 - 支付
Consumer --> ProcessPayment
ProcessPayment --> PaymentProcessed
ProcessPayment --> PaymentFailed
PaymentProcessed --> Payment
PaymentProcessed --> PaymentView
PaymentFailed --> PaymentRetryPolicy
PaymentProcessed --> PaymentGateway

Support --> ProcessRefund
ProcessRefund --> RefundProcessed
RefundProcessed --> Payment

' 流程連接 - 物流
OrderConfirmed --> ArrangeShipping
ArrangeShipping --> ShippingArranged
ShippingArranged --> LogisticsSystem
LogisticsSystem --> ShippingStatusUpdated
ShippingStatusUpdated --> ShippingView
ShippingView --> OrderTrackingUI

ShippingStatusUpdated --> OrderShipped
ShippingStatusUpdated --> OrderDelivered

' 流程連接 - 通知
OrderCreated --> NotificationPolicy
NotificationPolicy --> OrderConfirmationSent
OrderConfirmationSent --> EmailService
OrderConfirmationSent --> SMSService

ShippingArranged --> NotificationPolicy
NotificationPolicy --> ShippingNotificationSent
ShippingNotificationSent --> EmailService

OrderDelivered --> NotificationPolicy
NotificationPolicy --> DeliveryNotificationSent
DeliveryNotificationSent --> EmailService

' 流程連接 - 促銷
Consumer --> ApplyPromotion
ApplyPromotion --> PromotionApplied
PromotionApplied --> Promotion
PromotionApplied --> PromotionView
DiscountPolicy --> PromotionApplied

' 流程連接 - 客服
Consumer --> CreateSupportTicket
CreateSupportTicket --> SupportTicketCreated
SupportTicketCreated --> SupportTicket
SupportTicketCreated --> SupportView

' 流程連接 - 分析
Admin --> GenerateSalesReport
GenerateSalesReport --> SalesReportGenerated
SalesReportGenerated --> SalesReportView
SalesReportView --> AnalyticsSystem

' 熱點問題連接
CheckInventory --> InsufficientInventory
ProcessPayment --> PaymentSecurityIssue

' 圖例
legend right
  |= 元素類型 |= 顏色 |= 說明 |
  | <back:#FFA500>   </back> | 事件 | 系統中發生的重要業務事件 |
  | <back:#FFD700>   </back> | 參與者 | 觸發事件的人或角色 |
  | <back:#FF69B4>   </back> | 外部系統 | 與系統整合的外部服務 |
  | <back:#1E90FF>   </back> | 命令 | 觸發業務行為的意圖 |
  | <back:#FFFF00>   </back> | 聚合 | 維護業務規則的實體 |
  | <back:#32CD32>   </back> | 讀模型 | 用戶查詢的資訊視圖 |
  | <back:#800080>   </back> | 策略 | 事件觸發的業務規則 |
  | <back:#FF0000>   </back> | 熱點問題 | 需要解決的問題或風險點 |
  | <back:#32CD32>   </back> | 機會點 | 系統改進和優化的機會 |
  | <back:#F0E68C>   </back> | UI 模型 | 用戶介面和互動 |
  |= 連線類型 |= 說明 |
  | 實線箭頭 | 直接的因果關係或觸發關係 |
  | 虛線箭頭 | 潛在的問題或改進機會 |
endlegend

note top of Consumer
  Big Picture 階段重點：
  - 識別核心業務事件
  - 發現問題熱點
  - 找出改進機會
  - 理解整體業務流程
end note

@enduml