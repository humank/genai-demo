graph TB
    subgraph "同步處理層" ["同步處理層 (Synchronous Processing)"]
        WEB_REQUEST[Web 請求<br/>HTTP Request]
        API_CONTROLLER[API 控制器<br/>REST Controller]
        APP_SERVICE[應用服務<br/>Application Service]
        VALIDATION[輸入驗證<br/>Input Validation]
        IMMEDIATE_RESPONSE[即時響應<br/>Immediate Response]
    end
    
    subgraph "非同步處理層" ["非同步處理層 (Asynchronous Processing)"]
        subgraph "事件驅動處理" ["Event-Driven Processing"]
            EVENT_PUBLISHER[事件發布器<br/>Event Publisher]
            EVENT_BUS[事件匯流排<br/>Event Bus]
            EVENT_HANDLER[事件處理器<br/>Event Handler]
            SAGA_COORDINATOR[Saga 協調器<br/>Saga Coordinator]
        end
        
        subgraph "背景任務處理" ["Background Task Processing"]
            TASK_SCHEDULER[任務調度器<br/>Task Scheduler]
            ASYNC_EXECUTOR[非同步執行器<br/>Async Executor]
            BATCH_PROCESSOR[批次處理器<br/>Batch Processor]
            RETRY_MECHANISM[重試機制<br/>Retry Mechanism]
        end
        
        subgraph "訊息佇列處理" ["Message Queue Processing"]
            MESSAGE_PRODUCER[訊息生產者<br/>Message Producer]
            MESSAGE_QUEUE[訊息佇列<br/>Message Queue]
            MESSAGE_CONSUMER[訊息消費者<br/>Message Consumer]
            DLQ[死信佇列<br/>Dead Letter Queue]
        end
    end
    
    subgraph "並發控制" ["並發控制 (Concurrency Control)"]
        subgraph "鎖定機制" ["Locking Mechanisms"]
            OPTIMISTIC_LOCK[樂觀鎖<br/>Optimistic Locking]
            PESSIMISTIC_LOCK[悲觀鎖<br/>Pessimistic Locking]
            DISTRIBUTED_LOCK[分散式鎖<br/>Distributed Lock]
        end
        
        subgraph "線程池管理" ["Thread Pool Management"]
            WEB_THREAD_POOL[Web 線程池<br/>Web Thread Pool]
            ASYNC_THREAD_POOL[非同步線程池<br/>Async Thread Pool]
            SCHEDULED_THREAD_POOL[調度線程池<br/>Scheduled Thread Pool]
            VIRTUAL_THREAD_POOL[虛擬線程池<br/>Virtual Thread Pool]
        end
        
        subgraph "資源管理" ["Resource Management"]
            CONNECTION_POOL[連接池<br/>Connection Pool]
            CACHE_MANAGER[快取管理器<br/>Cache Manager]
            RATE_LIMITER[速率限制器<br/>Rate Limiter]
            CIRCUIT_BREAKER[斷路器<br/>Circuit Breaker]
        end
    end
    
    subgraph "非同步模式" ["非同步模式 (Async Patterns)"]
        subgraph "Future 模式" ["Future Pattern"]
            COMPLETABLE_FUTURE[CompletableFuture<br/>可完成的 Future]
            ASYNC_RESULT[非同步結果<br/>Async Result]
            CALLBACK_HANDLER[回調處理器<br/>Callback Handler]
        end
        
        subgraph "響應式模式" ["Reactive Pattern"]
            REACTIVE_STREAM[響應式流<br/>Reactive Stream]
            PUBLISHER[發布者<br/>Publisher]
            SUBSCRIBER[訂閱者<br/>Subscriber]
            BACKPRESSURE[背壓控制<br/>Backpressure]
        end
        
        subgraph "Actor 模式" ["Actor Pattern"]
            ACTOR_SYSTEM[Actor 系統<br/>Actor System]
            MESSAGE_PASSING[訊息傳遞<br/>Message Passing]
            MAILBOX[信箱<br/>Mailbox]
        end
    end
    
    subgraph "外部系統整合" ["外部系統整合 (External Integration)"]
        PAYMENT_API[支付 API<br/>Payment API]
        EMAIL_SERVICE[郵件服務<br/>Email Service]
        LOGISTICS_API[物流 API<br/>Logistics API]
        SEARCH_ENGINE[搜尋引擎<br/>Search Engine]
        ANALYTICS_SERVICE[分析服務<br/>Analytics Service]
    end
    
    subgraph "監控和可觀測性" ["監控和可觀測性 (Monitoring)"]
        ASYNC_METRICS[非同步指標<br/>Async Metrics]
        THREAD_MONITORING[線程監控<br/>Thread Monitoring]
        QUEUE_MONITORING[佇列監控<br/>Queue Monitoring]
        PERFORMANCE_TRACKING[性能追蹤<br/>Performance Tracking]
    end
    
    %% 同步處理流程
    WEB_REQUEST -->|HTTP| API_CONTROLLER
    API_CONTROLLER -->|調用| APP_SERVICE
    APP_SERVICE -->|驗證| VALIDATION
    VALIDATION -->|通過| IMMEDIATE_RESPONSE
    API_CONTROLLER -->|返回| IMMEDIATE_RESPONSE
    
    %% 非同步事件處理
    APP_SERVICE -->|發布事件| EVENT_PUBLISHER
    EVENT_PUBLISHER -->|發送| EVENT_BUS
    EVENT_BUS -->|分發| EVENT_HANDLER
    EVENT_HANDLER -->|協調| SAGA_COORDINATOR
    
    %% 背景任務處理
    APP_SERVICE -->|提交任務| TASK_SCHEDULER
    TASK_SCHEDULER -->|執行| ASYNC_EXECUTOR
    ASYNC_EXECUTOR -->|批次處理| BATCH_PROCESSOR
    BATCH_PROCESSOR -->|失敗重試| RETRY_MECHANISM
    
    %% 訊息佇列處理
    EVENT_PUBLISHER -->|生產訊息| MESSAGE_PRODUCER
    MESSAGE_PRODUCER -->|發送| MESSAGE_QUEUE
    MESSAGE_QUEUE -->|消費| MESSAGE_CONSUMER
    MESSAGE_CONSUMER -->|失敗| DLQ
    
    %% 並發控制
    APP_SERVICE -->|使用| OPTIMISTIC_LOCK
    SAGA_COORDINATOR -->|使用| DISTRIBUTED_LOCK
    ASYNC_EXECUTOR -->|管理| ASYNC_THREAD_POOL
    API_CONTROLLER -->|使用| WEB_THREAD_POOL
    TASK_SCHEDULER -->|使用| SCHEDULED_THREAD_POOL
    
    %% 資源管理
    APP_SERVICE -->|使用| CONNECTION_POOL
    EVENT_HANDLER -->|使用| CACHE_MANAGER
    API_CONTROLLER -->|限制| RATE_LIMITER
    MESSAGE_CONSUMER -->|保護| CIRCUIT_BREAKER
    
    %% 非同步模式
    ASYNC_EXECUTOR -->|返回| COMPLETABLE_FUTURE
    COMPLETABLE_FUTURE -->|完成| ASYNC_RESULT
    ASYNC_RESULT -->|回調| CALLBACK_HANDLER
    
    EVENT_BUS -->|流| REACTIVE_STREAM
    REACTIVE_STREAM -->|發布| PUBLISHER
    PUBLISHER -->|訂閱| SUBSCRIBER
    SUBSCRIBER -->|控制| BACKPRESSURE
    
    SAGA_COORDINATOR -->|使用| ACTOR_SYSTEM
    ACTOR_SYSTEM -->|傳遞| MESSAGE_PASSING
    MESSAGE_PASSING -->|存儲| MAILBOX
    
    %% 外部系統整合
    EVENT_HANDLER -->|調用| PAYMENT_API
    MESSAGE_CONSUMER -->|發送| EMAIL_SERVICE
    ASYNC_EXECUTOR -->|查詢| LOGISTICS_API
    BATCH_PROCESSOR -->|索引| SEARCH_ENGINE
    SAGA_COORDINATOR -->|報告| ANALYTICS_SERVICE
    
    %% 監控
    ASYNC_EXECUTOR -->|指標| ASYNC_METRICS
    ASYNC_THREAD_POOL -->|監控| THREAD_MONITORING
    MESSAGE_QUEUE -->|監控| QUEUE_MONITORING
    COMPLETABLE_FUTURE -->|追蹤| PERFORMANCE_TRACKING
    
    classDef sync fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef async fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef concurrency fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef pattern fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef external fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef monitoring fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    
    class WEB_REQUEST,API_CONTROLLER,APP_SERVICE,VALIDATION,IMMEDIATE_RESPONSE sync
    class EVENT_PUBLISHER,EVENT_BUS,EVENT_HANDLER,SAGA_COORDINATOR,TASK_SCHEDULER,ASYNC_EXECUTOR,BATCH_PROCESSOR,RETRY_MECHANISM,MESSAGE_PRODUCER,MESSAGE_QUEUE,MESSAGE_CONSUMER,DLQ async
    class OPTIMISTIC_LOCK,PESSIMISTIC_LOCK,DISTRIBUTED_LOCK,WEB_THREAD_POOL,ASYNC_THREAD_POOL,SCHEDULED_THREAD_POOL,VIRTUAL_THREAD_POOL,CONNECTION_POOL,CACHE_MANAGER,RATE_LIMITER,CIRCUIT_BREAKER concurrency
    class COMPLETABLE_FUTURE,ASYNC_RESULT,CALLBACK_HANDLER,REACTIVE_STREAM,PUBLISHER,SUBSCRIBER,BACKPRESSURE,ACTOR_SYSTEM,MESSAGE_PASSING,MAILBOX pattern
    class PAYMENT_API,EMAIL_SERVICE,LOGISTICS_API,SEARCH_ENGINE,ANALYTICS_SERVICE external
    class ASYNC_METRICS,THREAD_MONITORING,QUEUE_MONITORING,PERFORMANCE_TRACKING monitoring