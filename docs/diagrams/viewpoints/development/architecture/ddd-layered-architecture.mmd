graph TB
    subgraph "Presentation Layer"
        REST[REST Controllers]
        WEB[Web Controllers]
        CLI[CLI Interface]
    end
    
    subgraph "Application Layer"
        AS[Application Services]
        CH[Command Handlers]
        QH[Query Handlers]
        DTO[DTOs]
        VAL[Validation]
    end
    
    subgraph "Domain Layer"
        subgraph "Aggregates"
            CUST[Customer Aggregate]
            ORDER[Order Aggregate]
            PROD[Product Aggregate]
        end
        
        subgraph "Domain Services"
            DS[Domain Services]
            SPEC[Specifications]
            POLICY[Domain Policies]
        end
        
        subgraph "Domain Events"
            CE[Customer Events]
            OE[Order Events]
            PE[Product Events]
        end
        
        subgraph "Value Objects"
            EMAIL[Email]
            MONEY[Money]
            ADDR[Address]
        end
    end
    
    subgraph "Infrastructure Layer"
        subgraph "Persistence"
            REPO[Repositories]
            ORM[JPA/Hibernate]
            DB[(PostgreSQL)]
        end
        
        subgraph "Messaging"
            PUB[Event Publisher]
            SUB[Event Subscriber]
            MQ[Message Queue]
        end
        
        subgraph "External Services"
            PAY[Payment Gateway]
            EMAIL_SVC[Email Service]
            NOTIF[Notification Service]
        end
    end
    
    %% Dependencies (top to bottom)
    REST --> AS
    WEB --> AS
    CLI --> AS
    
    AS --> CH
    AS --> QH
    AS --> DTO
    AS --> VAL
    
    CH --> CUST
    CH --> ORDER
    CH --> PROD
    QH --> CUST
    QH --> ORDER
    QH --> PROD
    
    CUST --> DS
    ORDER --> DS
    PROD --> DS
    
    CUST --> CE
    ORDER --> OE
    PROD --> PE
    
    CUST --> EMAIL
    ORDER --> MONEY
    PROD --> MONEY
    ORDER --> ADDR
    
    %% Infrastructure dependencies
    AS --> REPO
    AS --> PUB
    
    REPO --> ORM
    ORM --> DB
    
    PUB --> MQ
    SUB --> MQ
    
    AS --> PAY
    AS --> EMAIL_SVC
    AS --> NOTIF
    
    %% Event flow
    CE --> PUB
    OE --> PUB
    PE --> PUB
    
    %% Styling
    classDef presentation fill:#e3f2fd
    classDef application fill:#f1f8e9
    classDef domain fill:#fff3e0
    classDef infrastructure fill:#fce4ec
    
    class REST,WEB,CLI presentation
    class AS,CH,QH,DTO,VAL application
    class CUST,ORDER,PROD,DS,SPEC,POLICY,CE,OE,PE,EMAIL,MONEY,ADDR domain
    class REPO,ORM,DB,PUB,SUB,MQ,PAY,EMAIL_SVC,NOTIF infrastructure