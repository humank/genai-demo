graph TB
    %% Distributed System Architecture
    %% Shows the complete distributed system with resilience patterns
    
    subgraph "Multi-Region Setup"
        subgraph "Primary Region (us-east-1)"
            subgraph "Availability Zone 1"
                ALB1[Application Load Balancer]
                EKS1[EKS Cluster - AZ1]
                RDS1[(RDS Primary)]
            end
            
            subgraph "Availability Zone 2"
                EKS2[EKS Cluster - AZ2]
                RDS2[(RDS Standby)]
            end
            
            subgraph "Shared Services"
                MSK_PRIMARY[Amazon MSK<br/>Event Streaming]
                ELASTICACHE[ElastiCache<br/>Redis Cluster]
                S3_PRIMARY[S3 Bucket<br/>Primary]
            end
        end
        
        subgraph "Secondary Region (us-west-2)"
            ALB_DR[ALB - DR]
            EKS_DR[EKS Cluster - DR]
            RDS_DR[(RDS Read Replica)]
            MSK_DR[Amazon MSK - DR]
            S3_DR[S3 Bucket - DR<br/>Cross-Region Replication]
        end
    end
    
    subgraph "Global Services"
        ROUTE53[Route 53<br/>DNS + Health Checks]
        CLOUDFRONT[CloudFront<br/>Global CDN]
        WAF[AWS WAF<br/>Web Application Firewall]
    end
    
    subgraph "Monitoring & Observability"
        XRAY[AWS X-Ray<br/>Distributed Tracing]
        CLOUDWATCH[CloudWatch<br/>Metrics & Logs]
        PROMETHEUS[Prometheus<br/>Custom Metrics]
        GRAFANA[Grafana<br/>Dashboards]
    end
    
    subgraph "Service Mesh & Communication"
        ISTIO[Istio Service Mesh<br/>Traffic Management]
        ENVOY[Envoy Proxy<br/>Sidecar Pattern]
        CIRCUIT_BREAKER[Circuit Breaker<br/>Hystrix/Resilience4j]
    end
    
    subgraph "Security & Compliance"
        IAM[AWS IAM<br/>Identity & Access]
        SECRETS[AWS Secrets Manager<br/>Secret Management]
        KMS[AWS KMS<br/>Encryption Keys]
        GUARDDUTY[GuardDuty<br/>Threat Detection]
    end
    
    %% External connections
    USERS[Users] --> ROUTE53
    ROUTE53 --> CLOUDFRONT
    CLOUDFRONT --> WAF
    WAF --> ALB1
    
    %% Failover connections
    ROUTE53 -.->|Failover| ALB_DR
    
    %% Load balancer to services
    ALB1 --> EKS1
    ALB1 --> EKS2
    ALB_DR --> EKS_DR
    
    %% Service mesh integration
    EKS1 --> ISTIO
    EKS2 --> ISTIO
    ISTIO --> ENVOY
    ENVOY --> CIRCUIT_BREAKER
    
    %% Data layer connections
    EKS1 --> RDS1
    EKS2 --> RDS1
    RDS1 --> RDS2
    RDS1 -.->|Async Replication| RDS_DR
    
    %% Caching layer
    EKS1 --> ELASTICACHE
    EKS2 --> ELASTICACHE
    
    %% Event streaming
    EKS1 --> MSK_PRIMARY
    EKS2 --> MSK_PRIMARY
    MSK_PRIMARY -.->|Cross-Region Replication| MSK_DR
    
    %% Storage
    EKS1 --> S3_PRIMARY
    EKS2 --> S3_PRIMARY
    S3_PRIMARY -.->|Cross-Region Replication| S3_DR
    
    %% Monitoring connections
    EKS1 --> XRAY
    EKS2 --> XRAY
    EKS_DR --> XRAY
    
    EKS1 --> CLOUDWATCH
    EKS2 --> CLOUDWATCH
    EKS_DR --> CLOUDWATCH
    
    EKS1 --> PROMETHEUS
    EKS2 --> PROMETHEUS
    PROMETHEUS --> GRAFANA
    
    %% Security connections
    EKS1 --> IAM
    EKS2 --> IAM
    EKS_DR --> IAM
    
    EKS1 --> SECRETS
    EKS2 --> SECRETS
    EKS_DR --> SECRETS
    
    EKS1 --> KMS
    EKS2 --> KMS
    EKS_DR --> KMS
    
    GUARDDUTY --> CLOUDWATCH
    
    %% Styling
    classDef primaryRegion fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef secondaryRegion fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef globalService fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef monitoring fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef serviceMesh fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef security fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef failover stroke-dasharray: 5 5,stroke:#ff5722,stroke-width:2px
    
    class ALB1,EKS1,EKS2,RDS1,RDS2,MSK_PRIMARY,ELASTICACHE,S3_PRIMARY primaryRegion
    class ALB_DR,EKS_DR,RDS_DR,MSK_DR,S3_DR secondaryRegion
    class ROUTE53,CLOUDFRONT,WAF globalService
    class XRAY,CLOUDWATCH,PROMETHEUS,GRAFANA monitoring
    class ISTIO,ENVOY,CIRCUIT_BREAKER serviceMesh
    class IAM,SECRETS,KMS,GUARDDUTY security
    
    %% Add notes for key patterns
    Note1[Resilience Patterns:<br/>• Circuit Breaker<br/>• Bulkhead<br/>• Timeout<br/>• Retry with Backoff]
    Note2[Observability:<br/>• Distributed Tracing<br/>• Metrics Collection<br/>• Centralized Logging<br/>• Health Checks]
    Note3[Security:<br/>• Zero Trust Network<br/>• Encryption at Rest/Transit<br/>• Secret Management<br/>• Threat Detection]