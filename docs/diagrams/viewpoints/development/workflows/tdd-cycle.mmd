flowchart LR
    %% TDD Red-Green-Refactor Cycle
    %% Shows the iterative Test-Driven Development process
    
    subgraph "TDD Cycle Overview"
        START([Start Feature]) --> RED[ðŸ”´ RED Phase<br/>Write Failing Test]
        RED --> GREEN[ðŸŸ¢ GREEN Phase<br/>Make Test Pass]
        GREEN --> REFACTOR[ðŸ”µ REFACTOR Phase<br/>Improve Code Quality]
        REFACTOR --> NEXT{More Tests Needed?}
        NEXT -->|Yes| RED
        NEXT -->|No| COMPLETE([Feature Complete])
    end
    
    subgraph "RED Phase - Write Failing Test"
        RED_START[Start RED Phase] --> UNDERSTAND[Understand Requirement<br/>What should the code do?]
        UNDERSTAND --> WRITE_TEST[Write Test Case<br/>Test the desired behavior]
        WRITE_TEST --> RUN_TEST[Run Test<br/>Verify it fails]
        RUN_TEST --> TEST_FAILS{Test Fails?}
        TEST_FAILS -->|No - Test Always Passes| FIX_TEST[Fix Test<br/>Make it properly fail]
        FIX_TEST --> RUN_TEST
        TEST_FAILS -->|Yes - Good| RED_COMPLETE[RED Phase Complete<br/>âœ… Failing test written]
        
        %% RED Phase Best Practices
        RED_PRACTICES[RED Phase Practices:<br/>â€¢ Write minimal test<br/>â€¢ Test one behavior<br/>â€¢ Use descriptive names<br/>â€¢ Arrange-Act-Assert pattern<br/>â€¢ Fail for right reason]
    end
    
    subgraph "GREEN Phase - Make Test Pass"
        GREEN_START[Start GREEN Phase] --> MINIMAL_CODE[Write Minimal Code<br/>Just enough to pass test]
        MINIMAL_CODE --> RUN_ALL_TESTS[Run All Tests<br/>Including existing ones]
        RUN_ALL_TESTS --> ALL_PASS{All Tests Pass?}
        ALL_PASS -->|No| DEBUG_FAILURE[Debug Failure<br/>Fix broken tests]
        DEBUG_FAILURE --> MINIMAL_CODE
        ALL_PASS -->|Yes| GREEN_COMPLETE[GREEN Phase Complete<br/>âœ… All tests passing]
        
        %% GREEN Phase Best Practices
        GREEN_PRACTICES[GREEN Phase Practices:<br/>â€¢ Simplest solution first<br/>â€¢ Don't over-engineer<br/>â€¢ Hard-code if necessary<br/>â€¢ Focus on making test pass<br/>â€¢ Ignore code quality for now]
    end
    
    subgraph "REFACTOR Phase - Improve Code Quality"
        REFACTOR_START[Start REFACTOR Phase] --> IDENTIFY_SMELLS[Identify Code Smells<br/>Duplication, complexity, etc.]
        IDENTIFY_SMELLS --> IMPROVE_CODE[Improve Code<br/>Extract methods, rename, etc.]
        IMPROVE_CODE --> RUN_TESTS_AGAIN[Run All Tests<br/>Ensure behavior unchanged]
        RUN_TESTS_AGAIN --> TESTS_STILL_PASS{All Tests Still Pass?}
        TESTS_STILL_PASS -->|No| REVERT_CHANGES[Revert Changes<br/>Back to working state]
        REVERT_CHANGES --> IMPROVE_CODE
        TESTS_STILL_PASS -->|Yes| MORE_REFACTOR{More Refactoring Needed?}
        MORE_REFACTOR -->|Yes| IDENTIFY_SMELLS
        MORE_REFACTOR -->|No| REFACTOR_COMPLETE[REFACTOR Phase Complete<br/>âœ… Clean, working code]
        
        %% REFACTOR Phase Best Practices
        REFACTOR_PRACTICES[REFACTOR Phase Practices:<br/>â€¢ Small, incremental changes<br/>â€¢ Run tests frequently<br/>â€¢ Extract methods/classes<br/>â€¢ Improve naming<br/>â€¢ Remove duplication<br/>â€¢ Simplify complex logic]
    end
    
    %% Detailed Examples
    subgraph "Example: Customer Validation"
        EX_RED[ðŸ”´ RED: Write test for<br/>invalid email validation]
        EX_GREEN[ðŸŸ¢ GREEN: Implement<br/>basic email regex check]
        EX_REFACTOR[ðŸ”µ REFACTOR: Extract<br/>EmailValidator class]
        
        EX_RED --> EX_GREEN
        EX_GREEN --> EX_REFACTOR
        EX_REFACTOR -.-> EX_RED2[ðŸ”´ RED: Test for<br/>null email handling]
    end
    
    subgraph "TDD Benefits"
        BENEFITS[TDD Benefits:<br/>â€¢ Better design through tests<br/>â€¢ High test coverage<br/>â€¢ Confidence in changes<br/>â€¢ Documentation through tests<br/>â€¢ Faster debugging<br/>â€¢ Reduced defects]
    end
    
    subgraph "Common TDD Mistakes"
        MISTAKES[Common Mistakes:<br/>â€¢ Writing too much code in GREEN<br/>â€¢ Skipping the RED phase<br/>â€¢ Not refactoring regularly<br/>â€¢ Testing implementation details<br/>â€¢ Writing complex tests<br/>â€¢ Not running tests frequently]
    end
    
    %% Test Types in TDD
    subgraph "Test Types"
        UNIT_TDD[Unit Tests<br/>â€¢ Fast execution<br/>â€¢ Isolated components<br/>â€¢ Mock dependencies<br/>â€¢ Business logic focus]
        
        INTEGRATION_TDD[Integration Tests<br/>â€¢ Component interaction<br/>â€¢ Database integration<br/>â€¢ External service calls<br/>â€¢ End-to-end scenarios]
        
        ACCEPTANCE_TDD[Acceptance Tests<br/>â€¢ User story validation<br/>â€¢ BDD scenarios<br/>â€¢ Business requirements<br/>â€¢ Customer acceptance]
    end
    
    %% TDD Tools and Frameworks
    subgraph "TDD Tools"
        JUNIT[JUnit 5<br/>â€¢ Test framework<br/>â€¢ Assertions<br/>â€¢ Test lifecycle<br/>â€¢ Parameterized tests]
        
        MOCKITO[Mockito<br/>â€¢ Mock objects<br/>â€¢ Stub behavior<br/>â€¢ Verify interactions<br/>â€¢ Argument matchers]
        
        ASSERTJ[AssertJ<br/>â€¢ Fluent assertions<br/>â€¢ Better readability<br/>â€¢ Rich API<br/>â€¢ Custom assertions]
        
        TESTCONTAINERS[Testcontainers<br/>â€¢ Integration testing<br/>â€¢ Database testing<br/>â€¢ External services<br/>â€¢ Isolated environments]
    end
    
    %% Cycle Timing
    RED_TIME[RED Phase: 2-5 minutes<br/>Write focused, failing test]
    GREEN_TIME[GREEN Phase: 2-10 minutes<br/>Implement minimal solution]
    REFACTOR_TIME[REFACTOR Phase: 2-15 minutes<br/>Improve code quality]
    
    %% Styling
    classDef redPhase fill:#ffebee,stroke:#c62828,stroke-width:3px
    classDef greenPhase fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
    classDef refactorPhase fill:#e3f2fd,stroke:#1565c0,stroke-width:3px
    classDef decision fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef practice fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef example fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef tool fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class RED,RED_START,UNDERSTAND,WRITE_TEST,RUN_TEST,FIX_TEST,RED_COMPLETE,EX_RED,EX_RED2 redPhase
    class GREEN,GREEN_START,MINIMAL_CODE,RUN_ALL_TESTS,DEBUG_FAILURE,GREEN_COMPLETE,EX_GREEN greenPhase
    class REFACTOR,REFACTOR_START,IDENTIFY_SMELLS,IMPROVE_CODE,RUN_TESTS_AGAIN,REVERT_CHANGES,REFACTOR_COMPLETE,EX_REFACTOR refactorPhase
    class TEST_FAILS,ALL_PASS,TESTS_STILL_PASS,MORE_REFACTOR,NEXT decision
    class RED_PRACTICES,GREEN_PRACTICES,REFACTOR_PRACTICES,BENEFITS,MISTAKES practice
    class UNIT_TDD,INTEGRATION_TDD,ACCEPTANCE_TDD example
    class JUNIT,MOCKITO,ASSERTJ,TESTCONTAINERS tool