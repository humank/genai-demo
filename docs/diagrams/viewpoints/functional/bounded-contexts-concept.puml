@startuml Bounded Contexts Concept
!theme plain
skinparam backgroundColor #FFFEF7
skinparam defaultFontName "Microsoft JhengHei"

title Bounded Contexts Concept\\nE-commerce Platform Domain Architecture

' 定義顏色
!define CORE_CONTEXT_COLOR #E8F5E8
!define SUPPORTING_CONTEXT_COLOR #E1F5FE
!define GENERIC_CONTEXT_COLOR #FFF3E0
!define SHARED_KERNEL_COLOR #F3E5F5
!define RELATIONSHIP_COLOR #FFE0B2

' 核心界限上下文
package "Core Bounded Contexts" <<CORE_CONTEXT_COLOR>> {
    
    rectangle "Order Context" as OrderContext <<CORE_CONTEXT_COLOR>> {
        note as OrderNote
            **核心聚合根**: Order, OrderWorkflow
            **主要職責**:
            • 訂單生命週期管理
            • 訂單狀態轉換
            • 訂單項目管理
            • 訂單驗證規則
            
            **關鍵事件**:
            • OrderCreatedEvent
            • OrderSubmittedEvent
            • OrderConfirmedEvent
        end note
    }
    
    rectangle "Customer Context" as CustomerContext <<CORE_CONTEXT_COLOR>> {
        note as CustomerNote
            **核心聚合根**: Customer
            **主要職責**:
            • 客戶資訊管理
            • 會員等級與積分
            • 客戶偏好設定
            • 客戶行為追蹤
            
            **關鍵事件**:
            • CustomerRegisteredEvent
            • CustomerProfileUpdatedEvent
        end note
    }
    
    rectangle "Product Context" as ProductContext <<CORE_CONTEXT_COLOR>> {
        note as ProductNote
            **核心聚合根**: Product
            **主要職責**:
            • 商品目錄管理
            • 商品規格與變體
            • 商品分類與標籤
            • 商品搜尋與推薦
            
            **關鍵事件**:
            • ProductCreatedEvent
            • ProductUpdatedEvent
        end note
    }
    
    rectangle "Payment Context" as PaymentContext <<CORE_CONTEXT_COLOR>> {
        note as PaymentNote
            **核心聚合根**: Payment
            **主要職責**:
            • 支付流程管理
            • 多種支付方式
            • 支付狀態追蹤
            • 退款處理
            
            **關鍵事件**:
            • PaymentProcessedEvent
            • PaymentFailedEvent
        end note
    }
}

' 支援界限上下文
package "Supporting Bounded Contexts" <<SUPPORTING_CONTEXT_COLOR>> {
    
    rectangle "Shopping Cart Context" as CartContext <<SUPPORTING_CONTEXT_COLOR>> {
        note as CartNote
            **核心聚合根**: ShoppingCart
            **主要職責**:
            • 購物車狀態管理
            • 商品加入/移除
            • 價格計算
            • 購物車持久化
        end note
    }
    
    rectangle "Inventory Context" as InventoryContext <<SUPPORTING_CONTEXT_COLOR>> {
        note as InventoryNote
            **核心聚合根**: Inventory
            **主要職責**:
            • 庫存數量管理
            • 庫存預留與釋放
            • 庫存警告與補貨
            • 庫存歷史追蹤
        end note
    }
    
    rectangle "Promotion Context" as PromotionContext <<SUPPORTING_CONTEXT_COLOR>> {
        note as PromotionNote
            **核心聚合根**: Promotion
            **主要職責**:
            • 優惠券管理
            • 促銷活動規則
            • 折扣計算
            • 促銷效果統計
        end note
    }
    
    rectangle "Delivery Context" as DeliveryContext <<SUPPORTING_CONTEXT_COLOR>> {
        note as DeliveryNote
            **核心聚合根**: Delivery
            **主要職責**:
            • 配送安排與追蹤
            • 配送員管理
            • 配送路線規劃
            • 配送狀態更新
        end note
    }
}

' 通用界限上下文
package "Generic Bounded Contexts" <<GENERIC_CONTEXT_COLOR>> {
    
    rectangle "Notification Context" as NotificationContext <<GENERIC_CONTEXT_COLOR>> {
        note as NotificationNote
            **核心聚合根**: Notification
            **主要職責**:
            • 多渠道通知發送
            • 通知模板管理
            • 通知偏好設定
            • 通知狀態追蹤
        end note
    }
    
    rectangle "Review Context" as ReviewContext <<GENERIC_CONTEXT_COLOR>> {
        note as ReviewNote
            **核心聚合根**: Review
            **主要職責**:
            • 商品評價管理
            • 評價審核機制
            • 評分統計計算
            • 評價展示規則
        end note
    }
    
    rectangle "Seller Context" as SellerContext <<GENERIC_CONTEXT_COLOR>> {
        note as SellerNote
            **核心聚合根**: Seller
            **主要職責**:
            • 賣家資訊管理
            • 賣家資格審核
            • 賣家績效統計
            • 賣家服務管理
        end note
    }
    
    rectangle "Observability Context" as ObservabilityContext <<GENERIC_CONTEXT_COLOR>> {
        note as ObservabilityNote
            **核心聚合根**: Observability
            **主要職責**:
            • 系統監控數據收集
            • 用戶行為分析
            • 性能指標追蹤
            • 業務指標統計
        end note
    }
}

' 共享內核
package "Shared Kernel" <<SHARED_KERNEL_COLOR>> {
    rectangle "Common Domain" as CommonDomain <<SHARED_KERNEL_COLOR>> {
        note as CommonNote
            **共享值對象**:
            • Money (金額)
            • OrderId (訂單ID)
            • CustomerId (客戶ID)
            • ProductId (商品ID)
            • PaymentId (支付ID)
            
            **共享事件**:
            • DomainEvent 接口
            • EventMetadata
            
            **共享服務**:
            • DomainEventPublisher
            • AggregateRoot 基類
        end note
    }
}

' 上下文關係 - 核心上下文間的關係
OrderContext ||--|| CustomerContext : Customer-Supplier
OrderContext ||--|| ProductContext : Customer-Supplier
OrderContext ||--|| PaymentContext : Partnership
OrderContext ||--|| InventoryContext : Customer-Supplier

' 核心上下文與支援上下文的關係
CartContext ||--|| OrderContext : Customer-Supplier
CartContext ||--|| ProductContext : Customer-Supplier
CartContext ||--|| PromotionContext : Customer-Supplier

PaymentContext ||--|| NotificationContext : Customer-Supplier
OrderContext ||--|| DeliveryContext : Customer-Supplier
OrderContext ||--|| NotificationContext : Customer-Supplier

ProductContext ||--|| ReviewContext : Customer-Supplier
ProductContext ||--|| SellerContext : Customer-Supplier

' 所有上下文與共享內核的關係
OrderContext ||..|| CommonDomain : Shared Kernel
CustomerContext ||..|| CommonDomain : Shared Kernel
ProductContext ||..|| CommonDomain : Shared Kernel
PaymentContext ||..|| CommonDomain : Shared Kernel
CartContext ||..|| CommonDomain : Shared Kernel
InventoryContext ||..|| CommonDomain : Shared Kernel
PromotionContext ||..|| CommonDomain : Shared Kernel
DeliveryContext ||..|| CommonDomain : Shared Kernel
NotificationContext ||..|| CommonDomain : Shared Kernel
ReviewContext ||..|| CommonDomain : Shared Kernel
SellerContext ||..|| CommonDomain : Shared Kernel
ObservabilityContext ||..|| CommonDomain : Shared Kernel

' 觀測性上下文與所有其他上下文的關係
ObservabilityContext ||--|| OrderContext : Conformist
ObservabilityContext ||--|| CustomerContext : Conformist
ObservabilityContext ||--|| ProductContext : Conformist
ObservabilityContext ||--|| PaymentContext : Conformist

' 圖例
legend right
    |= 關係類型 |= 說明 |
    | Partnership | 夥伴關係 - 雙方共同演進 |
    | Customer-Supplier | 客戶-供應商 - 下游依賴上游 |
    | Conformist | 順從者 - 完全依賴上游 |
    | Shared Kernel | 共享內核 - 共享代碼和模型 |
    
    |= 上下文類型 |= 顏色 |
    | Core Context | 綠色 - 核心業務領域 |
    | Supporting Context | 藍色 - 支援業務領域 |
    | Generic Context | 橙色 - 通用子領域 |
    | Shared Kernel | 紫色 - 共享內核 |
endlegend

@enduml