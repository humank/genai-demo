@startuml Business Process Flows
!theme plain
skinparam backgroundColor #FFFEF7
skinparam defaultFontName "Microsoft JhengHei"

title E-commerce Platform Business Process Flows\\n電商平台核心業務流程

' 定義顏色
!define PROCESS_COLOR #E1F5FE
!define DECISION_COLOR #FFF3E0
!define ACTION_COLOR #E8F5E8
!define ERROR_COLOR #FFEBEE
!define EXTERNAL_COLOR #F3E5F5

' 用戶角色
|顧客|
start
:顧客訪問註冊頁面;
:填寫註冊資訊;
if (資訊驗證) then (通過)
    :創建客戶帳戶;
    :發送歡迎郵件;
    :客戶登入成功;
else (失敗)
    :顯示錯誤訊息;
    stop
endif

:顧客瀏覽商品目錄;
:使用搜尋功能;
:查看商品詳情;
:閱讀商品評價;
if (商品感興趣?) then (是)
    :加入購物車;
else (否)
    :繼續瀏覽;
    stop
endif

:查看購物車;
while (調整商品?) is (是)
    :修改商品數量;
    :移除不需要商品;
    :重新計算總價;
endwhile (否)

if (使用優惠券?) then (是)
    :輸入優惠券代碼;
    if (優惠券有效?) then (是)
        :應用折扣;
        :更新總價;
    else (否)
        :顯示錯誤訊息;
    endif
endif
:確認購物車內容;

|系統|
:顧客提交訂單;

if (訂單資訊完整?) then (否)
    :要求補充資訊;
    stop
endif

:檢查商品庫存;
if (庫存充足?) then (否)
    :通知庫存不足;
    :建議替代商品;
    stop
endif

:計算訂單總價;
:應用促銷規則;
:計算運費;

|顧客|
:選擇支付方式;

|支付系統|
if (支付方式) then (信用卡)
    :調用 Stripe API;
    :驗證信用卡資訊;
elseif (支付方式) then (電子錢包)
    :調用 PayPal API;
    :驗證帳戶餘額;
elseif (支付方式) then (銀行轉帳)
    :生成轉帳資訊;
    :等待轉帳確認;
endif

if (支付驗證) then (成功)
    :扣款成功;
    :更新支付狀態;
    :發送支付確認;
else (失敗)
    :記錄失敗原因;
    :發送失敗通知;
    :觸發重試機制;
    :支付失敗處理;
    :釋放預留庫存;
    :通知支付失敗;
    stop
endif

|系統|
:預留商品庫存;
:生成訂單號;
:發送訂單確認;
:更新訂單狀態為已確認;

|賣家|
:通知賣家出貨;
:安排物流配送;
:生成配送單;

|配送系統|
:接收配送請求;
:分配配送員;
:規劃配送路線;
:生成配送任務;

|配送員|
:配送員接收任務;
:前往取貨地點;
:確認商品完整性;
:開始配送;

while (配送中?) is (是)
    :更新配送狀態;
    :通知客戶位置;
endwhile (否)

:到達配送地址;
if (客戶在家?) then (是)
    :交付商品;
    :確認收貨;
    :完成配送;
else (否)
    :嘗試聯繫客戶;
    if (聯繫成功?) then (是)
        :重新安排配送;
    else (否)
        :商品退回;
        :通知配送失敗;
    endif
endif

|庫存系統|
:接收庫存更新請求;

if (操作類型) then (入庫)
    :增加庫存數量;
    :更新庫存記錄;
elseif (操作類型) then (出庫)
    if (庫存充足?) then (是)
        :減少庫存數量;
        :更新庫存記錄;
    else (否)
        :庫存不足警告;
        :通知補貨;
    endif
elseif (操作類型) then (預留)
    :預留指定數量;
    :設定預留期限;
elseif (操作類型) then (釋放)
    :釋放預留庫存;
    :恢復可用庫存;
endif

:發送庫存變更事件;
:更新商品可用性;

|通知系統|
:接收通知觸發事件;
:查詢客戶通知偏好;

if (通知渠道) then (郵件)
    :發送郵件通知;
elseif (通知渠道) then (簡訊)
    :發送簡訊通知;
elseif (通知渠道) then (推播)
    :發送推播通知;
elseif (通知渠道) then (站內信)
    :發送站內信;
endif

:記錄通知發送狀態;
if (發送成功?) then (是)
    :更新通知狀態為已發送;
else (否)
    :記錄失敗原因;
    :安排重試;
endif

|賣家|
:賣家登入系統;
:選擇商品管理功能;

if (操作類型) then (新增商品)
    :填寫商品資訊;
    :上傳商品圖片;
    :設定價格與庫存;
    :提交審核;
elseif (操作類型) then (編輯商品)
    :修改商品資訊;
    :更新價格;
    :調整庫存;
    :保存變更;
elseif (操作類型) then (下架商品)
    :選擇下架原因;
    :確認下架;
    :更新商品狀態;
endif

|系統|
:系統審核商品;
if (審核通過?) then (是)
    :商品上架;
    :通知賣家;
else (否)
    :通知審核失敗原因;
    :要求修改;
endif

|管理員|
:管理員創建促銷活動;
:設定促銷規則;
:設定適用商品範圍;
:設定有效期限;
:設定使用條件;

if (促銷類型) then (折扣券)
    :設定折扣金額或比例;
    :生成優惠券代碼;
elseif (促銷類型) then (滿減活動)
    :設定滿額條件;
    :設定減免金額;
elseif (促銷類型) then (買贈活動)
    :設定購買條件;
    :設定贈品內容;
endif

:發布促銷活動;
:通知相關客戶;

while (活動進行中?) is (是)
    :監控使用情況;
    :統計活動效果;
endwhile (否)

:活動結束;
:生成活動報告;

|客服系統|
:客戶提出問題或投訴;

if (問題類型) then (訂單問題)
    :查詢訂單狀態;
    :提供解決方案;
elseif (問題類型) then (商品問題)
    :查詢商品資訊;
    :協助退換貨;
elseif (問題類型) then (支付問題)
    :查詢支付記錄;
    :協助退款處理;
elseif (問題類型) then (配送問題)
    :查詢配送狀態;
    :協調重新配送;
endif

:記錄服務過程;
:客戶滿意度調查;
:結案;

stop

@enduml