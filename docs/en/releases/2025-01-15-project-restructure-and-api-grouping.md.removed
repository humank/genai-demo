
# å°ˆæ¡ˆRefactoringå’Œ API åˆ†çµ„å„ªåŒ– - 2025-01-15

## ğŸ“‹ è®Šæ›´æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸»è¦é‡å°å°ˆæ¡ˆçµæ§‹é‡æ•´å’Œ API åˆ†çµ„Policyå„ªåŒ–ï¼Œæå‡å°ˆæ¡ˆçš„Maintainabilityå’Œ API æ–‡æª”çš„ä½¿ç”¨é«”é©—ã€‚

## ğŸ”„ ä¸»è¦è®Šæ›´

### 1. å°ˆæ¡ˆæª”æ¡ˆçµæ§‹é‡æ•´

#### ğŸ“ æ–°çš„ç›®éŒ„çµæ§‹

```
genai-demo/
â”œâ”€â”€ docker/                 # Docker ç›¸é—œæª”æ¡ˆ
â”‚   â”œâ”€â”€ docker-build.sh    # ARM64 æ˜ åƒæ§‹å»ºè…³æœ¬
â”‚   â”œâ”€â”€ verify-deployment.sh # Deployment
â”‚   â””â”€â”€ postgres/           # PostgreSQL åˆå§‹åŒ–è…³æœ¬
â”œâ”€â”€ deployment/             # Deployment
â”‚   â”œâ”€â”€ k8s/               # Kubernetes é…ç½®
â”‚   â”œâ”€â”€ deploy-to-eks.sh   # Deployment
â”‚   â””â”€â”€ aws-eks-architecture.md
â”œâ”€â”€ scripts/                # å„ç¨®è…³æœ¬æª”æ¡ˆ
â”‚   â”œâ”€â”€ start-fullstack.sh # å•Ÿå‹•å…¨æ£§æ‡‰ç”¨
â”‚   â”œâ”€â”€ stop-fullstack.sh  # åœæ­¢æ‰€æœ‰æœå‹™
â”‚   â”œâ”€â”€ test-api.sh        # Testing
â”‚   â”œâ”€â”€ verify-swagger-ui.sh # Swagger UI é©—è­‰
â”‚   â””â”€â”€ generate_data.py   # Testing
â”œâ”€â”€ tools-and-environment/                  # Tools
â”‚   â””â”€â”€ plantuml.jar       # Tools
â””â”€â”€ docs/                   # å°ˆæ¡ˆæ–‡æª” (æ“´å……)
    â”œâ”€â”€ ../api/               # API ç›¸é—œæ–‡æª”
    â”œâ”€â”€ releases/          # ç‰ˆæœ¬ç™¼å¸ƒè¨˜éŒ„
    â””â”€â”€ ...
```

#### ğŸ—‚ï¸ ç§»å‹•çš„æª”æ¡ˆ

- **Docker ç›¸é—œ**: `docker-build.sh`, `verify-deployment.sh` â†’ `docker/`
- **Deploymentç›¸é—œ**: `deploy-to-eks.sh`, `k8s/`, `aws-eks-architecture.md` â†’ `deployment/`
- **è…³æœ¬æª”æ¡ˆ**: `start-fullstack.sh`, `stop-fullstack.sh`, `test-api.sh`, `verify-swagger-ui.sh`, `generate_data.py` â†’ `scripts/`
- **å·¥å…·æª”æ¡ˆ**: `plantuml.jar` â†’ `tools-and-environment/`
- **æ–‡æª”æª”æ¡ˆ**: å„ç¨® `.md` æª”æ¡ˆ â†’ `docs/`

### Design

#### ğŸ¯ åŸºæ–¼ DDD å’ŒUserè§’è‰²çš„åˆ†çµ„

**èˆŠçš„åˆ†çµ„æ–¹å¼**:

- `public-api`: æ‰€æœ‰å…¬é–‹ API
- `internal-api`: å…§éƒ¨ API
- `management`: ç®¡ç†ç«¯é»

**æ–°çš„åˆ†çµ„æ–¹å¼**:

- `customer-api`: Customerç«¯ API (é¢å‘çµ‚ç«¯Customer)
- `operator-api`: é‹ç‡Ÿç®¡ç† API (é¢å‘å¹³å°é‹ç‡Ÿè€…)
- `system-api`: ç³»çµ±ç®¡ç† API (é¢å‘System Administrator)

#### ğŸ“Š åˆ†çµ„è©³ç´°èªªæ˜

##### Customerç«¯ API (`customer-api`)

**ç›®æ¨™User**: çµ‚ç«¯Customer (Customer)
**åŒ…å«è·¯å¾‘**:

- `/../api/products/**` - å•†å“ç€è¦½
- `/api/orders/**` - å€‹äººè¨‚å–®æŸ¥è©¢
- `/api/payments/**` - æ”¯ä»˜è™•ç†
- `/api/consumer/**` - æ¶ˆè²»è€…åŠŸèƒ½
- `/api/shopping-cart/**` - è³¼ç‰©è»Š
- `/api/promotions/**` - ä¿ƒéŠ·æ´»å‹•
- `/api/vouchers/**` - å„ªæƒ åˆ¸
- `/api/reviews/**` - å•†å“è©•åƒ¹
- `/api/recommendations/**` - å€‹äººåŒ–æ¨è–¦
- `/api/notifications/**` - å€‹äººé€šçŸ¥
- `/api/delivery-tracking/**` - é…é€Tracing

##### é‹ç‡Ÿç®¡ç† API (`operator-api`)

**ç›®æ¨™User**: å¹³å°é‹ç‡Ÿè€… (Operator/Admin)
**åŒ…å«è·¯å¾‘**:

- `/../api/customers/**` - Customerç®¡ç†
- `/api/orders/**` - å…¨å¹³å°è¨‚å–®ç®¡ç†
- `/api/products/**` - å•†å“ç®¡ç† (CRUD)
- `/../api/inventory/**` - åº«å­˜ç®¡ç†
- `/api/pricing/**` - å®šåƒ¹Policy
- `/api/payments/**` - æ”¯ä»˜ç®¡ç†
- `/api/activities/**` - ç³»çµ±æ´»å‹•è¨˜éŒ„
- `/api/stats/**` - çµ±è¨ˆå ±è¡¨
- `/api/admin/**` - ç®¡ç†å“¡å°ˆç”¨åŠŸèƒ½

##### ç³»çµ±ç®¡ç† API (`system-api`)

**ç›®æ¨™User**: System Administratorã€DevOps
**åŒ…å«è·¯å¾‘**:

- `/../api/internal/**` - å…§éƒ¨ç³»çµ±æ•´åˆ
- `/api/management/**` - ç³»çµ±ç®¡ç†åŠŸèƒ½
- `/actuator/**` - Spring Boot Actuator

### 3. OpenAPI æ¨™ç±¤å„ªåŒ–

#### ğŸ·ï¸ æ–°çš„æ¨™ç±¤é«”ç³»

**Customerç«¯æ¨™ç±¤** (ä¸­æ–‡å‘½åï¼Œæ›´ç›´è§€):

- ç”¢å“ç€è¦½ã€è³¼ç‰©è»Šã€è¨‚å–®æŸ¥è©¢ã€æ”¯ä»˜è™•ç†
- ä¿ƒéŠ·æ´»å‹•ã€å•†å“è©•åƒ¹ã€å€‹äººåŒ–æ¨è–¦
- é€šçŸ¥ä¸­å¿ƒã€é…é€Tracing

**é‹ç‡Ÿç®¡ç†æ¨™ç±¤**:

- Customerç®¡ç†ã€è¨‚å–®ç®¡ç†ã€å•†å“ç®¡ç†
- åº«å­˜ç®¡ç†ã€å®šåƒ¹ç®¡ç†ã€æ”¯ä»˜ç®¡ç†
- çµ±è¨ˆå ±è¡¨ã€æ´»å‹•è¨˜éŒ„

**ç³»çµ±ç®¡ç†æ¨™ç±¤**:

- ç³»çµ±Monitoringã€å…§éƒ¨æ•´åˆ

### 4. é ˜åŸŸæ¨¡å‹å®Œå–„

#### ğŸ—ï¸ DDD æ¶æ§‹å¢å¼·

- **ä¿ƒéŠ·è¦å‰‡å¼•æ“**: å®Œæ•´å¯¦ä½œ sealed interface çš„ä¿ƒéŠ·è¦å‰‡é«”ç³»
- **è³¼ç‰©è»ŠAggregate**: å¯¦ä½œå®Œæ•´çš„è³¼ç‰©è»Šæ¥­å‹™é‚è¼¯å’Œå„ªæƒ è¨ˆç®—
- **CustomerAggregate**: å¢å¼·Customeræ¨¡å‹ï¼Œæ”¯æ´ç´…åˆ©é»æ•¸å’Œé€šçŸ¥åå¥½
- **è¨‚å–®Aggregate**: å®Œå–„è¨‚å–®ç”Ÿå‘½é€±æœŸç®¡ç†å’Œç‹€æ…‹è½‰æ›

#### Testing

- **BDD æ¸¬è©¦**: å¯¦ä½œæ¶ˆè²»è€…è³¼ç‰©æµç¨‹çš„è¡Œç‚ºé©…å‹•æ¸¬è©¦
- **Architecture Test**: ä½¿ç”¨ ArchUnit ç¢ºä¿ DDD æ¶æ§‹åˆè¦æ€§
- **Integration Test**: å®Œæ•´çš„ API ç«¯é»æ¸¬è©¦è¦†è“‹
- **Unit Test**: é ˜åŸŸé‚è¼¯å’Œæ¥­å‹™è¦å‰‡çš„Unit Test

## ğŸ”§ æŠ€è¡“æ”¹é€²

### Docker å„ªåŒ–

- **ARM64 åŸç”Ÿæ”¯æ´**: é‡å° Apple Silicon å’Œ ARM64 ä¼ºæœå™¨å„ªåŒ–
- **å¤šéšæ®µæ§‹å»º**: æœ€å°åŒ–æœ€çµ‚æ˜ åƒå¤§å°
- **JVM èª¿å„ª**: å®¹å™¨Environmentå°ˆç”¨çš„ JVM åƒæ•¸
- **Health Check**: å®Œæ•´çš„æ‡‰ç”¨ç¨‹å¼Monitoringæ©Ÿåˆ¶

### é–‹ç™¼é«”é©—æå‡

- **ç›®éŒ„èªªæ˜æ–‡æª”**: æ¯å€‹æ–°ç›®éŒ„éƒ½åŒ…å« README.md èªªæ˜
- **è…³æœ¬åŸ·è¡Œæ¬Šé™**: è‡ªå‹•è¨­å®šæ‰€æœ‰è…³æœ¬çš„åŸ·è¡Œæ¬Šé™
- **è·¯å¾‘å¼•ç”¨æ›´æ–°**: æ›´æ–°æ‰€æœ‰æ–‡æª”ä¸­çš„æª”æ¡ˆè·¯å¾‘å¼•ç”¨

## ğŸ“± ä½¿ç”¨æ–¹å¼æ›´æ–°

### æ–°çš„è…³æœ¬è·¯å¾‘

```bash
# Docker ç›¸é—œ
./docker/docker-build.sh
./docker/verify-deployment.sh

# å…¨æ£§æ‡‰ç”¨
./scripts/start-fullstack.sh
./scripts/stop-fullstack.sh

# Testing
./scripts/test-api.sh
./scripts/verify-swagger-ui.sh

# è³‡æ–™ç”Ÿæˆ
python3 scripts/generate_data.py

# Deployment
./deployment/deploy-to-eks.sh

# Tools
java -jar tools-and-environment/plantuml.jar docs/uml/*.puml
```

### API æ–‡æª”è¨ªå•

```bash
# Customerç«¯ API æ–‡æª”
http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/customer-api

# é‹ç‡Ÿç®¡ç† API æ–‡æª”  
http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/operator-api

# ç³»çµ±ç®¡ç† API æ–‡æª”
http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/system-api
```

## ğŸ¯ å½±éŸ¿å’Œæ•ˆç›Š

### é–‹ç™¼æ•ˆç‡æå‡

- **æ¸…æ™°çš„ç›®éŒ„çµæ§‹**: Developerèƒ½å¿«é€Ÿæ‰¾åˆ°ç›¸é—œæª”æ¡ˆ
- **åŠŸèƒ½åˆ†çµ„**: ç›¸é—œåŠŸèƒ½é›†ä¸­ç®¡ç†ï¼Œé™ä½ç¶­è­·æˆæœ¬
- **æ–‡æª”å®Œæ•´æ€§**: æ¯å€‹ç›®éŒ„éƒ½æœ‰è©³ç´°çš„ä½¿ç”¨èªªæ˜

### API ä½¿ç”¨é«”é©—æ”¹å–„

- **è§’è‰²å°å‘åˆ†çµ„**: ä¸åŒUseråªçœ‹åˆ°ç›¸é—œçš„ API
- **ä¸­æ–‡æ¨™ç±¤**: æ›´ç›´è§€çš„ API åˆ†é¡å’Œæè¿°
- **æ™ºèƒ½è·¯å¾‘åŒ¹é…**: è‡ªå‹•å°‡ API æ­¸é¡åˆ°æ­£ç¢ºçš„åˆ†çµ„

### æ¶æ§‹å“è³ªæå‡

- **DDD åˆè¦æ€§**: é€šéArchitecture Testç¢ºä¿Design Principle
- **æ¸¬è©¦è¦†è“‹**: å¤šå±¤æ¬¡çš„æ¸¬è©¦Policyä¿è­‰Code Quality
- **Containerizationå„ªåŒ–**: ARM64 åŸç”Ÿæ”¯æ´å’Œæ•ˆèƒ½èª¿å„ª

## Guidelines

### å°ç¾æœ‰Userçš„å½±éŸ¿

1. **è…³æœ¬è·¯å¾‘è®Šæ›´**: éœ€è¦æ›´æ–° CI/CD è…³æœ¬ä¸­çš„è·¯å¾‘å¼•ç”¨
2. **API æ–‡æª”è¨ªå•**: å¯ä»¥ä½¿ç”¨æ–°çš„åˆ†çµ„ URL ç²å¾—æ›´å¥½çš„é«”é©—
3. **é–‹ç™¼å·¥å…·**: PlantUML ç­‰å·¥å…·è·¯å¾‘å·²è®Šæ›´

### recommendationsçš„é·ç§»æ­¥é©Ÿ

1. æ›´æ–°æœ¬åœ°è…³æœ¬ä¸­çš„è·¯å¾‘å¼•ç”¨
2. é‡æ–°æ§‹å»º Docker æ˜ åƒä»¥ç²å¾—æœ€æ–°å„ªåŒ–
3. ä½¿ç”¨æ–°çš„ API åˆ†çµ„ URL è¨ªå•æ–‡æª”
4. æª¢æŸ¥ CI/CD æµç¨‹ä¸­çš„è·¯å¾‘å¼•ç”¨

## ğŸ“š ç›¸é—œæ–‡æª”

- \1
- [API ç‰ˆæœ¬ç®¡ç†Policy](../../api/API_VERSIONING_STRATEGY.md)
- [å°ˆæ¡ˆç›®éŒ„çµæ§‹èªªæ˜](../../README.md#å°ˆæ¡ˆç›®éŒ„çµæ§‹)
- \1

---

**ç™¼å¸ƒæ—¥æœŸ**: 2025-01-15  
**ç‰ˆæœ¬**: v2.0.0  
**å½±éŸ¿ç¯„åœ**: å°ˆæ¡ˆçµæ§‹ã€API æ–‡æª”ã€é–‹ç™¼å·¥å…·
