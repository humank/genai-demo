05fa06af22657defb1e120fabeab2bf5
"use strict";
/**
 * Jest setup file for CDK testing infrastructure
 * Configures global test environment and utilities
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TestUtils = exports.TestDataFactory = void 0;
const cdk = require("aws-cdk-lib");
// Global test configuration
beforeAll(() => {
    // Set default CDK context for all tests
    process.env.CDK_DEFAULT_ACCOUNT = '123456789012';
    process.env.CDK_DEFAULT_REGION = 'ap-northeast-1';
});
// Custom Jest matchers for CDK testing
expect.extend({
    toHaveResource(template, resourceType, properties) {
        const resources = template.toJSON().Resources || {};
        const matchingResources = Object.values(resources).filter((resource) => resource.Type === resourceType);
        if (matchingResources.length === 0) {
            return {
                message: () => `Expected template to have resource of type ${resourceType}`,
                pass: false,
            };
        }
        if (properties) {
            const hasMatchingProperties = matchingResources.some((resource) => this.equals(resource.Properties, expect.objectContaining(properties)));
            if (!hasMatchingProperties) {
                return {
                    message: () => `Expected template to have resource of type ${resourceType} with properties ${JSON.stringify(properties)}`,
                    pass: false,
                };
            }
        }
        return {
            message: () => `Expected template not to have resource of type ${resourceType}`,
            pass: true,
        };
    },
    toHaveResourceCount(template, resourceType, expectedCount) {
        const resources = template.toJSON().Resources || {};
        const matchingResources = Object.values(resources).filter((resource) => resource.Type === resourceType);
        const actualCount = matchingResources.length;
        return {
            message: () => `Expected ${expectedCount} resources of type ${resourceType}, but found ${actualCount}`,
            pass: actualCount === expectedCount,
        };
    }
});
// Test data factories
class TestDataFactory {
    static createTestApp(context) {
        return new cdk.App({
            context: {
                'genai-demo:networking': {
                    'availability-zones': 3,
                    'enable-vpc-flow-logs': true,
                    'enable-dns-hostnames': true,
                    'enable-dns-support': true
                },
                'genai-demo:environments': {
                    'test': {
                        'vpc-cidr': '10.0.0.0/16',
                        'nat-gateways': 1,
                        'retention-policies': {
                            'logs': 7,
                            'metrics': 7,
                            'backups': 7,
                            'snapshots': 3
                        }
                    },
                    'development': {
                        'vpc-cidr': '10.1.0.0/16',
                        'nat-gateways': 1,
                        'retention-policies': {
                            'logs': 7,
                            'metrics': 30,
                            'backups': 30,
                            'snapshots': 7
                        }
                    },
                    'production': {
                        'vpc-cidr': '10.2.0.0/16',
                        'nat-gateways': 3,
                        'retention-policies': {
                            'logs': 90,
                            'metrics': 365,
                            'backups': 365,
                            'snapshots': 30
                        }
                    }
                },
                'genai-demo:observability': {
                    'log-retention-days': 7,
                    'metrics-retention-days': 30,
                    'trace-sampling-rate': 0.1
                },
                'hosted-zone:account=123456789012:domainName=kimkao.io:region=ap-east-2': {
                    'Id': '/hostedzone/Z2KTO3AQUJG1DT',
                    'Name': 'kimkao.io.'
                },
                ...context
            }
        });
    }
    static createTestStackProps(overrides) {
        return {
            environment: 'test',
            projectName: 'genai-demo-test',
            env: {
                account: '123456789012',
                region: 'ap-northeast-1'
            },
            ...overrides
        };
    }
}
exports.TestDataFactory = TestDataFactory;
// Test utilities
class TestUtils {
    static getResourcesByType(template, resourceType) {
        const resources = template.toJSON().Resources || {};
        return Object.entries(resources)
            .filter(([_, resource]) => resource.Type === resourceType)
            .map(([logicalId, resource]) => ({ logicalId, ...resource }));
    }
    static getOutputs(template) {
        return template.toJSON().Outputs || {};
    }
    static getParameters(template) {
        return template.toJSON().Parameters || {};
    }
    static hasTag(resource, key, value) {
        const tags = resource.Properties?.Tags || [];
        const tag = tags.find((t) => t.Key === key);
        return tag && (value === undefined || tag.Value === value);
    }
}
exports.TestUtils = TestUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lpa2Fpa2FvL2dpdC9nZW5haS1kZW1vL2luZnJhc3RydWN0dXJlL3Rlc3Qvc2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsbUNBQW1DO0FBRW5DLDRCQUE0QjtBQUM1QixTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ1gsd0NBQXdDO0lBQ3hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEdBQUcsY0FBYyxDQUFDO0lBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEdBQUcsZ0JBQWdCLENBQUM7QUFDdEQsQ0FBQyxDQUFDLENBQUM7QUFhSCx1Q0FBdUM7QUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNWLGNBQWMsQ0FBQyxRQUFhLEVBQUUsWUFBb0IsRUFBRSxVQUFnQjtRQUNoRSxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQztRQUNwRCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUNyRCxDQUFDLFFBQWEsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxZQUFZLENBQ3BELENBQUM7UUFFRixJQUFJLGlCQUFpQixDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxPQUFPO2dCQUNILE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyw4Q0FBOEMsWUFBWSxFQUFFO2dCQUMzRSxJQUFJLEVBQUUsS0FBSzthQUNkLENBQUM7UUFDTixDQUFDO1FBRUQsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNiLE1BQU0scUJBQXFCLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBYSxFQUFFLEVBQUUsQ0FDbkUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUN4RSxDQUFDO1lBRUYsSUFBSSxDQUFD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QUNqRCxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksR0FBRyxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsQ0FBQztJQUMvRCxDQUFDO0NBQ0o7QUFyQkQsOEJBcUJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95aWthaWthby9naXQvZ2VuYWktZGVtby9pbmZyYXN0cnVjdHVyZS90ZXN0L3NldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSmVzdCBzZXR1cCBmaWxlIGZvciBDREsgdGVzdGluZyBpbmZyYXN0cnVjdHVyZVxuICogQ29uZmlndXJlcyBnbG9iYWwgdGVzdCBlbnZpcm9ubWVudCBhbmQgdXRpbGl0aWVzXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcblxuLy8gR2xvYmFsIHRlc3QgY29uZmlndXJhdGlvblxuYmVmb3JlQWxsKCgpID0+IHtcbiAgICAvLyBTZXQgZGVmYXVsdCBDREsgY29udGV4dCBmb3IgYWxsIHRlc3RzXG4gICAgcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfQUNDT1VOVCA9ICcxMjM0NTY3ODkwMTInO1xuICAgIHByb2Nlc3MuZW52LkNES19ERUZBVUxUX1JFR0lPTiA9ICdhcC1ub3J0aGVhc3QtMSc7XG59KTtcblxuLy8gR2xvYmFsIHRlc3QgdXRpbGl0aWVzXG5kZWNsYXJlIGdsb2JhbCB7XG4gICAgbmFtZXNwYWNlIGplc3Qge1xuICAgICAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xuICAgICAgICAgICAgdG9IYXZlUmVzb3VyY2UocmVzb3VyY2VUeXBlOiBzdHJpbmcsIHByb3BlcnRpZXM/OiBhbnkpOiBSO1xuICAgICAgICAgICAgdG9IYXZlUmVzb3VyY2VDb3VudChyZXNvdXJjZVR5cGU6IHN0cmluZywgY291bnQ6IG51bWJlcik6IFI7XG4gICAgICAgICAgICB0b01hdGNoU25hcHNob3QoKTogUjtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gQ3VzdG9tIEplc3QgbWF0Y2hlcnMgZm9yIENESyB0ZXN0aW5nXG5leHBlY3QuZXh0ZW5kKHtcbiAgICB0b0hhdmVSZXNvdXJjZSh0ZW1wbGF0ZTogYW55LCByZXNvdXJjZVR5cGU6IHN0cmluZywgcHJvcGVydGllcz86IGFueSkge1xuICAgICAgICBjb25zdCByZXNvdXJjZXMgPSB0ZW1wbGF0ZS50b0pTT04oKS5SZXNvdXJjZXMgfHwge307XG4gICAgICAgIGNvbnN0IG1hdGNoaW5nUmVzb3VyY2VzID0gT2JqZWN0LnZhbHVlcyhyZXNvdXJjZXMpLmZpbHRlcihcbiAgICAgICAgICAgIChyZXNvdXJjZTogYW55KSA9PiByZXNvdXJjZS5UeXBlID09PSByZXNvdXJjZVR5cGVcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAobWF0Y2hpbmdSZXNvdXJjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCB0ZW1wbGF0ZSB0byBoYXZlIHJlc291cmNlIG9mIHR5cGUgJHtyZXNvdXJjZVR5cGV9YCxcbiAgICAgICAgICAgICAgICBwYXNzOiBmYWxzZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJvcGVydGllcykge1xuICAgICAgICAgICAgY29uc3QgaGFzTWF0Y2hpbmdQcm9wZXJ0aWVzID0gbWF0Y2hpbmdSZXNvdXJjZXMuc29tZSgocmVzb3VyY2U6IGFueSkgPT5cbiAgICAgICAgICAgICAgICB0aGlzLmVxdWFscyhyZXNvdXJjZS5Qcm9wZXJ0aWVzLCBleHBlY3Qub2JqZWN0Q29udGFpbmluZyhwcm9wZXJ0aWVzKSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghaGFzTWF0Y2hpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkIHRlbXBsYXRlIHRvIGhhdmUgcmVzb3VyY2Ugb2YgdHlwZSAke3Jlc291cmNlVHlwZX0gd2l0aCBwcm9wZXJ0aWVzICR7SlNPTi5zdHJpbmdpZnkocHJvcGVydGllcyl9YCxcbiAgICAgICAgICAgICAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgdGVtcGxhdGUgbm90IHRvIGhhdmUgcmVzb3VyY2Ugb2YgdHlwZSAke3Jlc291cmNlVHlwZX1gLFxuICAgICAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdG9IYXZlUmVzb3VyY2VDb3VudCh0ZW1wbGF0ZTogYW55LCByZXNvdXJjZVR5cGU6IHN0cmluZywgZXhwZWN0ZWRDb3VudDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRlbXBsYXRlLnRvSlNPTigpLlJlc291cmNlcyB8fCB7fTtcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdSZXNvdXJjZXMgPSBPYmplY3QudmFsdWVzKHJlc291cmNlcykuZmlsdGVyKFxuICAgICAgICAgICAgKHJlc291cmNlOiBhbnkpID0+IHJlc291cmNlLlR5cGUgPT09IHJlc291cmNlVHlwZVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGFjdHVhbENvdW50ID0gbWF0Y2hpbmdSZXNvdXJjZXMubGVuZ3RoO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgJHtleHBlY3RlZENvdW50fSByZXNvdXJjZXMgb2YgdHlwZSAke3Jlc291cmNlVHlwZX0sIGJ1dCBmb3VuZCAke2FjdHVhbENvdW50fWAsXG4gICAgICAgICAgICBwYXNzOiBhY3R1YWxDb3VudCA9PT0gZXhwZWN0ZWRDb3VudCxcbiAgICAgICAgfTtcbiAgICB9XG59KTtcblxuLy8gVGVzdCBkYXRhIGZhY3Rvcmllc1xuZXhwb3J0IGNsYXNzIFRlc3REYXRhRmFjdG9yeSB7XG4gICAgc3RhdGljIGNyZWF0ZVRlc3RBcHAoY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBjZGsuQXBwIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjZGsuQXBwKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAnZ2VuYWktZGVtbzpuZXR3b3JraW5nJzoge1xuICAgICAgICAgICAgICAgICAgICAnYXZhaWxhYmlsaXR5LXpvbmVzJzogMyxcbiAgICAgICAgICAgICAgICAgICAgJ2VuYWJsZS12cGMtZmxvdy1sb2dzJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgJ2VuYWJsZS1kbnMtaG9zdG5hbWVzJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgJ2VuYWJsZS1kbnMtc3VwcG9ydCc6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdnZW5haS1kZW1vOmVudmlyb25tZW50cyc6IHtcbiAgICAgICAgICAgICAgICAgICAgJ3Rlc3QnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAndnBjLWNpZHInOiAnMTAuMC4wLjAvMTYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25hdC1nYXRld2F5cyc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAncmV0ZW50aW9uLXBvbGljaWVzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsb2dzJzogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWV0cmljcyc6IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JhY2t1cHMnOiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzbmFwc2hvdHMnOiAzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICdkZXZlbG9wbWVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd2cGMtY2lkcic6ICcxMC4xLjAuMC8xNicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmF0LWdhdGV3YXlzJzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdyZXRlbnRpb24tcG9saWNpZXMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZ3MnOiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXRyaWNzJzogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JhY2t1cHMnOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc25hcHNob3RzJzogN1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAncHJvZHVjdGlvbic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd2cGMtY2lkcic6ICcxMC4yLjAuMC8xNicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmF0LWdhdGV3YXlzJzogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdyZXRlbnRpb24tcG9saWNpZXMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZ3MnOiA5MCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWV0cmljcyc6IDM2NSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFja3Vwcyc6IDM2NSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc25hcHNob3RzJzogMzBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2dlbmFpLWRlbW86b2JzZXJ2YWJpbGl0eSc6IHtcbiAgICAgICAgICAgICAgICAgICAgJ2xvZy1yZXRlbnRpb24tZGF5cyc6IDcsXG4gICAgICAgICAgICAgICAgICAgICdtZXRyaWNzLXJldGVudGlvbi1kYXlzJzogMzAsXG4gICAgICAgICAgICAgICAgICAgICd0cmFjZS1zYW1wbGluZy1yYXRlJzogMC4xXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnaG9zdGVkLXpvbmU6YWNjb3VudD0xMjM0NTY3ODkwMTI6ZG9tYWluTmFtZT1raW1rYW8uaW86cmVnaW9uPWFwLWVhc3QtMic6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0lkJzogJy9ob3N0ZWR6b25lL1oyS1RPM0FRVUpHMURUJyxcbiAgICAgICAgICAgICAgICAgICAgJ05hbWUnOiAna2lta2FvLmlvLidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC4uLmNvbnRleHRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGNyZWF0ZVRlc3RTdGFja1Byb3BzKG92ZXJyaWRlcz86IFBhcnRpYWw8YW55Pik6IGFueSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbnZpcm9ubWVudDogJ3Rlc3QnLFxuICAgICAgICAgICAgcHJvamVjdE5hbWU6ICdnZW5haS1kZW1vLXRlc3QnLFxuICAgICAgICAgICAgZW52OiB7XG4gICAgICAgICAgICAgICAgYWNjb3VudDogJzEyMzQ1Njc4OTAxMicsXG4gICAgICAgICAgICAgICAgcmVnaW9uOiAnYXAtbm9ydGhlYXN0LTEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLi4ub3ZlcnJpZGVzXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vLyBUZXN0IHV0aWxpdGllc1xuZXhwb3J0IGNsYXNzIFRlc3RVdGlscyB7XG4gICAgc3RhdGljIGdldFJlc291cmNlc0J5VHlwZSh0ZW1wbGF0ZTogYW55LCByZXNvdXJjZVR5cGU6IHN0cmluZyk6IGFueVtdIHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2VzID0gdGVtcGxhdGUudG9KU09OKCkuUmVzb3VyY2VzIHx8IHt9O1xuICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocmVzb3VyY2VzKVxuICAgICAgICAgICAgLmZpbHRlcigoW18sIHJlc291cmNlXTogW3N0cmluZywgYW55XSkgPT4gcmVzb3VyY2UuVHlwZSA9PT0gcmVzb3VyY2VUeXBlKVxuICAgICAgICAgICAgLm1hcCgoW2xvZ2ljYWxJZCwgcmVzb3VyY2VdKSA9PiAoeyBsb2dpY2FsSWQsIC4uLihyZXNvdXJjZSBhcyBvYmplY3QpIH0pKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0T3V0cHV0cyh0ZW1wbGF0ZTogYW55KTogUmVjb3JkPHN0cmluZywgYW55PiB7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZS50b0pTT04oKS5PdXRwdXRzIHx8IHt9O1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQYXJhbWV0ZXJzKHRlbXBsYXRlOiBhbnkpOiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlLnRvSlNPTigpLlBhcmFtZXRlcnMgfHwge307XG4gICAgfVxuXG4gICAgc3RhdGljIGhhc1RhZyhyZXNvdXJjZTogYW55LCBrZXk6IHN0cmluZywgdmFsdWU/OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgdGFncyA9IHJlc291cmNlLlByb3BlcnRpZXM/LlRhZ3MgfHwgW107XG4gICAgICAgIGNvbnN0IHRhZyA9IHRhZ3MuZmluZCgodDogYW55KSA9PiB0LktleSA9PT0ga2V5KTtcbiAgICAgICAgcmV0dXJuIHRhZyAmJiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0YWcuVmFsdWUgPT09IHZhbHVlKTtcbiAgICB9XG59Il0sInZlcnNpb24iOjN9